@model LBDUSite.ViewModels.PortfolioSimulatorViewModel
@{
    ViewBag.Title = "Portfolio Simulator";
}

<div class="top-bar">
    <div class="logo">
        Portfolio Investment Wizard
    </div>
    <div style="font-size: 0.9rem; color: #787b86;">
        Smart Asset Allocation & Order Management
    </div>
</div>

<div class="main-container">
    <!-- Left Panel: Wizard Steps -->
    <div class="left-panel">
        <!-- Step Indicators -->
        <div class="wizard-steps">
            <div class="step-indicator active" id="step-indicator-1" data-step="1">
                <div class="step-number">1</div>
                <div class="step-info">
                    <h4>Investment Amount</h4>
                    <p>จำนวนเงินที่ต้องการลงทุน</p>
                </div>
            </div>
            <div class="step-indicator" id="step-indicator-2" data-step="2">
                <div class="step-number">2</div>
                <div class="step-info">
                    <h4>Risk Profile</h4>
                    <p>เลือกระดับความเสี่ยง</p>
                </div>
            </div>
            <div class="step-indicator" id="step-indicator-3" data-step="3">
                <div class="step-number">3</div>
                <div class="step-info">
                    <h4>Asset Allocation</h4>
                    <p>ปรับสัดส่วนการลงทุน</p>
                </div>
            </div>
            <div class="step-indicator" id="step-indicator-4" data-step="4">
                <div class="step-number">4</div>
                <div class="step-info">
                    <h4>Review & Submit</h4>
                    <p>ตรวจสอบและส่งคำสั่งซื้อ</p>
                </div>
            </div>
        </div>

        <!-- Step 1: Investment Amount -->
        <div class="wizard-content" id="step-1">
            <h3>💰 Investment Amount</h3>

            <div class="form-group">
                <label>จำนวนเงินที่ต้องการลงทุน</label>
                <div class="amount-input-group">
                    <span class="amount-prefix">฿</span>
                    <input type="number" class="form-input amount-input" id="investment-amount"
                           value="@Model.InvestmentAmount" min="1000" step="1000">
                </div>
                <div style="margin-top: 8px; font-size: 0.85rem; color: #787b86;">
                    ขั้นต่ำ: ฿1,000 | แนะนำ: ฿100,000+
                </div>
            </div>

            <div class="form-group">
                <label>ระยะเวลาลงทุน</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="time-horizon" min="1" max="30" value="@Model.TimeHorizon">
                    <div style="text-align: center; margin-top: 10px; font-size: 1.2rem; font-weight: 600; color: #2962ff;">
                        <span id="time-value">@Model.TimeHorizon</span> ปี
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>เป้าหมายการลงทุน</label>
                <select class="form-input" id="investment-goal">
                    <option value="retirement">เกษียณอายุ</option>
                    <option value="wealth">สร้างความมั่งคั่ง</option>
                    <option value="education">การศึกษาบุตร</option>
                    <option value="house">ซื้อบ้าน/ที่ดิน</option>
                    <option value="income">สร้างรายได้เสริม</option>
                </select>
            </div>

            <div class="btn-wizard">
                <button class="btn btn-primary btn-next">
                    Next: เลือกระดับความเสี่ยง →
                </button>
            </div>
        </div>

        <!-- Step 2: Risk Profile -->
        <div class="wizard-content" id="step-2" style="display: none;">
            <h3>🎯 Risk Profile Selection</h3>

            <div class="risk-grid" id="risk-options">
                @foreach (var risk in Model.RiskProfiles)
                {
                    <div class="risk-option @(risk.Key == Model.SelectedRisk ? "selected" : "")" data-risk="@risk.Key">
                        <div class="risk-option-header">
                            <span class="risk-icon">@risk.Value.Icon</span>
                            <span class="risk-name">@risk.Value.Name.Replace(" Portfolio", "")</span>
                        </div>
                        <div class="risk-desc">@risk.Value.Description</div>
                    </div>
                }
            </div>

            <div class="btn-wizard">
                <button class="btn btn-secondary btn-prev">← Back</button>
                <button class="btn btn-primary btn-next">Next: ปรับสัดส่วน →</button>
            </div>
        </div>

        <!-- Step 3: Asset Allocation -->
        <div class="wizard-content" id="step-3" style="display: none;">
            <h3>📊 Asset Allocation</h3>

            <div class="mode-toggle">
                <button class="mode-btn active" id="mode-recommend" data-mode="recommend">
                    🎯 Recommended
                </button>
                <button class="mode-btn" id="mode-advanced" data-mode="advanced">
                    ⚙️ Advanced
                </button>
            </div>

            <div id="recommend-mode">
                <div style="background: rgba(41, 98, 255, 0.1); padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #2962ff;">
                    <div style="font-size: 0.9rem; color: #d1d4dc;">
                        <strong>Recommended Allocation:</strong><br>
                        ระบบแนะนำสัดส่วนตาม Risk Profile ของคุณ
                    </div>
                </div>
            </div>

            <div id="advanced-mode" style="display: none;">
                <div class="allocation-adjuster">
                    <div class="adjuster-item">
                        <div class="adjuster-header">
                            <span style="color: #f44336;">● Equity Funds</span>
                            <span class="adjuster-value" id="equity-value">40%</span>
                        </div>
                        <input type="range" class="slider allocation-slider" data-asset="equity" id="equity-slider" min="0" max="100" value="40">
                    </div>

                    <div class="adjuster-item">
                        <div class="adjuster-header">
                            <span style="color: #ff9800;">● Mixed Funds</span>
                            <span class="adjuster-value" id="mixed-value">30%</span>
                        </div>
                        <input type="range" class="slider allocation-slider" data-asset="mixed" id="mixed-slider" min="0" max="100" value="30">
                    </div>

                    <div class="adjuster-item">
                        <div class="adjuster-header">
                            <span style="color: #4caf50;">● Fixed Income</span>
                            <span class="adjuster-value" id="fixed-value">20%</span>
                        </div>
                        <input type="range" class="slider allocation-slider" data-asset="fixed" id="fixed-slider" min="0" max="100" value="20">
                    </div>

                    <div class="adjuster-item">
                        <div class="adjuster-header">
                            <span style="color: #2196f3;">● Money Market</span>
                            <span class="adjuster-value" id="money-value">10%</span>
                        </div>
                        <input type="range" class="slider allocation-slider" data-asset="money" id="money-slider" min="0" max="100" value="10">
                    </div>

                    <div class="total-allocation" id="total-allocation">
                        <span>Total Allocation:</span>
                        <span id="total-value" style="font-weight: bold; font-size: 1.1rem;">100%</span>
                    </div>
                </div>
            </div>

            <div class="btn-wizard">
                <button class="btn btn-secondary btn-prev">← Back</button>
                <button class="btn btn-primary btn-next">Next: Review Order →</button>
            </div>
        </div>

        <!-- Step 4: Review -->
        <div class="wizard-content" id="step-4" style="display: none;">
            <h3>✅ Review & Submit Order</h3>

            <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
                <div style="font-size: 0.9rem; color: #d1d4dc; line-height: 1.6;">
                    <strong>Ready to invest!</strong><br>
                    กรุณาตรวจสอบรายละเอียดด้านขวา<br>
                    และกดปุ่ม "Submit Order" เพื่อส่งคำสั่งซื้อ
                </div>
            </div>

            <div class="btn-wizard">
                <button class="btn btn-secondary btn-prev">← Back</button>
                <button class="btn btn-success" id="btn-submit">
                    📋 Submit Order
                </button>
            </div>
        </div>
    </div>

    <!-- Center Panel: Preview -->
    <div class="center-panel">
        <div class="preview-card">
            <div class="preview-header">
                <div class="preview-title">📊 Portfolio Preview</div>
                <div class="risk-badge balanced" id="risk-badge">Balanced Portfolio</div>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Investment Amount</div>
                    <div class="metric-value" id="preview-amount">฿100,000</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Expected Return/Year</div>
                    <div class="metric-value" style="color: #4caf50;" id="preview-return">8.5%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Time Horizon</div>
                    <div class="metric-value" id="preview-time">10 Years</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Projected Value</div>
                    <div class="metric-value" style="color: #2962ff;" id="preview-projected">฿227,000</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="allocation-chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Right Panel: Order Summary -->
    <div class="right-panel">
        <div class="section-title">📋 Order Summary</div>

        <div class="order-summary">
            <div class="summary-row">
                <span class="summary-label">Investment Amount</span>
                <span class="summary-value" id="summary-amount">฿100,000</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Number of Funds</span>
                <span class="summary-value" id="summary-funds">8 Funds</span>
            </div>
            <div class="summary-row total">
                <span class="summary-label">Total Order Value</span>
                <span class="summary-value" id="summary-total">฿100,000</span>
            </div>
        </div>

        <div class="section-title">💼 Fund Allocation</div>
        <div class="asset-allocation-list" id="order-list">
            <div class="empty-state" style="padding: 40px 10px;">
                <div style="font-size: 2rem; margin-bottom: 10px;">📊</div>
                <p style="font-size: 0.9rem;">เริ่มต้นโดยกรอกข้อมูลทางซ้าย</p>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/portfolio-simulator.css">
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Pass model data to JavaScript
        var initialData = {
            investmentAmount: @Model.InvestmentAmount,
            timeHorizon: @Model.TimeHorizon,
            selectedRisk: '@Model.SelectedRisk',
            riskProfiles: @Html.Raw(Json.Serialize(Model.RiskProfiles)),
            fundDatabase: @Html.Raw(Json.Serialize(Model.FundDatabase))
        };
    </script>
    <script src="~/js/portfolio-simulator.js"></script>
}