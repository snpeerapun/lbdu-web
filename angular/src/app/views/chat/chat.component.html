<div class="d-flex ">
  <!-- Chat Container -->
  <div class="chat-container bg-white rounded shadow-sm flex-grow-1">
    <!-- Chat Header -->
    <div class="chat-header border-bottom p-3">
      <h5 class="mb-0">{{ 'chat.title' | translate }}</h5>
    </div>

    <!-- Chat Messages -->
    <div #messageContainer class="chat-messages p-3" style="height: calc(100vh - 350px); overflow-y: auto;">
      <div class="message-wrapper" *ngFor="let message of messages">
        <!-- AI Message -->
        <div class="message ai-message mb-3 d-flex" *ngIf="message.role === 'assistant'">
          <div class="message-avatar me-2">
            <i class="fas fa-robot"></i>
          </div>
          <div class="d-flex flex-column">
            <div class="message-content bg-light rounded p-3" style="max-width: 70%;">
              <div class="message-text">{{message.content}}</div>
            </div>
            <div class="message-time small text-muted mt-1 ms-1">
              {{ message.timestamp | date:'HH:mm' }}
            </div>
          </div>
        </div>

        <!-- User Message -->
        <div class="message user-message mb-3 d-flex justify-content-end" *ngIf="message.role === 'user'">
          <div class="d-flex flex-column align-items-end">
            <div class="message-content bg-primary text-white rounded p-3" style="max-width: 70%;">
              <div class="message-text" *ngIf="message.content">{{message.content}}</div>
              <img *ngIf="message.image" [src]="message.image" class="message-image" alt="{{ 'chat.uploadedImage' | translate }}">
            </div>
            <div class="message-time text-muted mt-1 me-1">
              {{ message.timestamp | date:'HH:mm' }}
            </div>
          </div>
          <div class="message-avatar ms-2">
            <i class="fas fa-user"></i>
          </div>
        </div>
      </div>
      
      <!-- Loading Indicator -->
      <div class="message ai-message mb-3 d-flex" *ngIf="isLoading">
        <div class="message-avatar me-2">
          <i class="fas fa-robot"></i>
        </div>
        <div class="message-content bg-light rounded p-3">
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Input -->
    <div class="chat-input border-top p-3">
      <div class="d-flex gap-2 align-items-start">
        <!-- Text Input and Image Preview Column -->
        <div class="flex-grow-1">
          <!-- Selected Image Preview -->
          <div class="d-flex align-items-center mb-2" *ngIf="selectedImage">
            <div class="position-relative me-2" style="width: 100px;">
              <img [src]="selectedImage" class="preview-image" alt="{{ 'chat.selectedImage' | translate }}">
              <button type="button" class="btn-close position-absolute top-0 end-0 m-1"
                      style="background-color: white; padding: 4px; border-radius: 50%;"
                      (click)="removeSelectedImage()">
              </button>
            </div>
          </div>

          <!-- Text Input -->
          <input type="text" class="form-control" 
                 placeholder="{{ 'chat.inputPlaceholder' | translate }}" 
                 [formControl]="messageInput" 
                 (keyup.enter)="sendMessage()">
        </div>

        <!-- Action Buttons -->
        <div class="d-flex gap-2">
          <!-- Hidden file input -->
          <input #fileInput type="file" accept="image/*" class="d-none" (change)="handleFileInput($event)">
          
          <!-- Image upload button -->
          <button class="btn btn-outline-secondary" (click)="openFileInput()" type="button" title="{{ 'chat.uploadImage' | translate }}">
            <i class="fas fa-image"></i>
          </button>

          <!-- Send button -->
          <button class="btn btn-primary" (click)="sendMessage()" [disabled]="isLoading" title="{{ 'chat.sendMessage' | translate }}">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>

      <!-- Suggested Questions -->
      <div class="suggested-questions mt-3" *ngIf="suggestedQuestions.length > 0">
        <div class="d-flex flex-wrap gap-2">
          <button *ngFor="let question of suggestedQuestions" 
                  class="btn btn-outline-secondary btn-sm"
                  (click)="selectSuggestedQuestion(question)">
            {{ question }}
          </button>
        </div>
      </div>
    </div>
  </div>

 
</div>

<style>
  .message-text {
    white-space: pre-wrap;
    word-wrap: break-word;
    line-height: 1.5;
  }

  .preview-image {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 4px;
    border: 1px solid #dee2e6;
  }

  .message-image {
    max-width: 200px;
    max-height: 200px;
    border-radius: 4px;
    margin-top: 8px;
    object-fit: contain;
  }

  .chat-messages {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
  }

  .message-content {
    word-break: break-word;
  }

  .message-time {
    font-size: 0.75rem;
    opacity: 0.8;
  }

  .message-avatar {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #e9ecef;
    border-radius: 50%;
  }
</style>
