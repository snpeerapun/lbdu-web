<div class="login-container d-flex justify-content-center align-items-center">
 
    <div class="form-container">
   
      <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()" *ngIf="!showOtpScreen && !showNewPasswordScreen">
        <h2>{{ 'forgotPassword.title' | translate }}</h2>
        <p class="subtitle">{{ 'forgotPassword.subtitle' | translate }}</p>
        
        <div class="form-group">
          <div class="input-group">
            <input type="email" 
                  formControlName="email" 
                  [placeholder]="'forgotPassword.form.email.placeholder' | translate"
                  [class.is-invalid]="forgotPasswordForm.get('email')?.invalid && forgotPasswordForm.get('email')?.touched">
            <i class="fas fa-envelope input-icon"></i>
            <div class="invalid-feedback" *ngIf="forgotPasswordForm.get('email')?.errors?.['required'] && forgotPasswordForm.get('email')?.touched">
              {{ 'forgotPassword.validation.required' | translate }}
            </div>
            <div class="invalid-feedback" *ngIf="forgotPasswordForm.get('email')?.errors?.['email'] && forgotPasswordForm.get('email')?.touched">
              {{ 'forgotPassword.validation.email' | translate }}
            </div>
          </div>
        </div>

        <button type="submit" class="btn-auth" [disabled]="forgotPasswordForm.invalid || isLoading" [class.loading]="isLoading">
          {{ 'forgotPassword.button.reset' | translate }}
        </button>

        <div class="register-link">
          <a routerLink="/login">
            <i class="fas fa-arrow-left"></i>
            {{ 'forgotPassword.button.backToLogin' | translate }}
          </a>
        </div>
      </form>

      <!-- OTP Validation Section -->
      <form [formGroup]="otpForm" *ngIf="showOtpScreen && !showNewPasswordScreen">
        <h3>{{ 'forgotPassword.otpTitle' | translate }}</h3>
        <p class="subtitle">{{ 'forgotPassword.otpSubtitle' | translate }}</p>
        
        <div class="form-group">
          <label class="otp-label">{{ 'forgotPassword.form.otp.label' | translate }}</label>
          <ng-otp-input 
            #otpInput
            [otpControl]="$any(otpForm.get('otp'))"
            [length]="6"
            (otpChange)="onOtpChange($event)">
          </ng-otp-input>
        
        </div>

        <div class="resend-otp">
          <a href="javascript:void(0)" (click)="resendOtp()">
            <i class="fas fa-sync-alt"></i>
            {{ 'forgotPassword.button.resendOtp' | translate }}
          </a>
        </div>

        <div class="register-link">
          <a routerLink="/login">
            <i class="fas fa-arrow-left"></i>
            {{ 'forgotPassword.button.backToLogin' | translate }}
          </a>
        </div>
      </form>

      <!-- New Password Section -->
      <form [formGroup]="newPasswordForm" (ngSubmit)="onResetPassword()" *ngIf="showNewPasswordScreen">
        <h3>{{ 'forgotPassword.newPasswordTitle' | translate }}</h3>
        <p class="subtitle">{{ 'forgotPassword.newPasswordSubtitle' | translate }}</p>
        
        <div class="form-group">
          <div class="input-group">
            <input [type]="showPassword ? 'text' : 'password'" 
                  formControlName="password" 
                  [placeholder]="'forgotPassword.form.password.placeholder' | translate"
                  [class.is-invalid]="newPasswordForm.get('password')?.invalid && newPasswordForm.get('password')?.touched">
            <i class="fas fa-lock input-icon"></i>
            <i class="password-toggle" 
               [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"
               (click)="togglePasswordVisibility('password')"></i>
            <div class="invalid-feedback" *ngIf="newPasswordForm.get('password')?.errors?.['required'] && newPasswordForm.get('password')?.touched">
              {{ 'forgotPassword.validation.required' | translate }}
            </div>
            <div class="invalid-feedback" *ngIf="newPasswordForm.get('password')?.errors?.['minlength'] && newPasswordForm.get('password')?.touched">
              {{ 'forgotPassword.validation.passwordLength' | translate }}
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="input-group">
            <input [type]="showConfirmPassword ? 'text' : 'password'" 
                  formControlName="confirmPassword" 
                  [placeholder]="'forgotPassword.form.confirmPassword.placeholder' | translate"
                  [class.is-invalid]="(newPasswordForm.get('confirmPassword')?.invalid || newPasswordForm.errors?.['mismatch']) && newPasswordForm.get('confirmPassword')?.touched">
            <i class="fas fa-lock input-icon"></i>
            <i class="password-toggle" 
               [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"
               (click)="togglePasswordVisibility('confirmPassword')"></i>
            <div class="invalid-feedback" *ngIf="newPasswordForm.get('confirmPassword')?.errors?.['required'] && newPasswordForm.get('confirmPassword')?.touched">
              {{ 'forgotPassword.validation.required' | translate }}
            </div>
            <div class="invalid-feedback" *ngIf="newPasswordForm.errors?.['mismatch'] && newPasswordForm.get('confirmPassword')?.touched">
              {{ 'forgotPassword.validation.passwordMismatch' | translate }}
            </div>
          </div>
        </div>

        <button type="submit" class="btn-auth" [disabled]="newPasswordForm.invalid || isLoading" [class.loading]="isLoading">
          {{ 'forgotPassword.button.resetPassword' | translate }}
        </button>

        <div class="register-link">
          <a routerLink="/login">
            <i class="fas fa-arrow-left"></i>
            {{ 'forgotPassword.button.backToLogin' | translate }}
          </a>
        </div>
      </form>
    </div>
 
</div>